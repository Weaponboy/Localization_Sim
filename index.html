<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>

    <style>
        #backround {
            width: 540px;
            height: 540px;
            margin-left: 50px;
            margin-right: 30px;
            margin-bottom: 10px;
        }

        #display {
            position: absolute;
            top: 60%;
            left: 92%;
        }

        #displayPath {
            position: absolute;
            top: 60%;
            left: 82%;
        }

        .point {
            width: 2px;
            height: 2px;
            background-color: rgb(0, 255, 34);
            /* Make it round */
            position: absolute;
        }

        #mySlider {
            position: absolute;
            top: 90%;
            left: 8%;
            width: 30%;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .robotPos {
            width: 8px;
            height: 8px;
            background-color: red;
            border-radius: 50%;
            position: absolute;

        }
    </style>

</head>

<body style="display: inline-flex;">

    <div id="drop_zone" style="height: fit-content; width: fit-content;">
        <h1 style="font-size: 120%; text-align: center; margin-top: 20px;">Field View</h1>
        <img ondrop="dropHandler(event);" ondragover="dragOverHandler(event);"
            src="images/custom-centerstage-field-diagrams-works-with-meepmeep-v0-uqcy8o9sfpob1.png" id="backround"
            alt="">
    </div>

    <input type="range" min="0" max="100" value="0" class="slider" id="mySlider">
    <div id="sliderValue" style="position: absolute; top: 92%; left: 22%;">50</div>
    <div id="start" style="position: absolute; top: 89.2%; left: 6%;">0</div>
    <div id="end" style="position: absolute; top: 89.2%; left: 39%;">100</div>

    <div style="height: 600px; width: 200px;">
        <div id="globalPosition" style="margin-top: 44px;">
            <h1 style="font-size: 120%;">Global Odometry Position</h1>
            <div
                style="font-size: 100%; font-weight: 500; border-style: solid; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                X: <h2 id="XPosition"
                    style=" margin: 0; font-size: 100%; font-weight: 500;  padding-left: 0.5rem; padding-top: 2px;">
                </h2>
            </div>
            <div
                style="font-size: 100%; font-weight: 500; border-style: solid; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                Y: <h2 id="YPosition"
                    style="font-size: 100%; font-weight: 500; margin: 0;  padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
            <div
                style="font-size: 100%; font-weight: 500; border-style: solid; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                Heading: <h2 id="Heading"
                    style=" margin: 0; font-size: 100%; font-weight: 500; padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
        </div>

        <div id="globalPosition" style="margin-top: 19px;">
            <h1 style="font-size: 100%;">Odometry Pod Readings</h1>
            <div
                style="border-style: solid; font-weight: 500; font-size: 100%; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                Left Pod: <h2 id="LeftPod"
                    style=" margin: 0; font-size: 100%; font-weight: 500; padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
            <div
                style="border-style: solid; font-weight: 500; font-size: 100%; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                Right Pod: <h2 id="RightPod"
                    style=" margin: 0; font-size: 100%; font-weight: 500; padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
            <div
                style="border-style: solid; font-weight: 500; font-size: 100%; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                Center Pod: <h2 id="CenterPod"
                    style=" margin: 0; font-size: 100%; font-weight: 500; padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
        </div>

        <div id="globalPosition" style="margin-top: 19px;">
            <h1 style="font-size: 120%;">Global Robot Velocity</h1>
            <div
                style="border-style: solid; font-size: 100%; font-weight: 500; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                X Velocity: <h2 id="XVelo"
                    style=" margin: 0; font-size: 100%; font-weight: 500; padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
            <div
                style="border-style: solid; font-size: 100%; font-weight: 500; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                Y Velocity: <h2 id="YVelo"
                    style=" margin: 0; font-size: 100%; font-weight: 500; padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
            <div
                style="border-style: solid; font-size: 100%; font-weight: 500; padding: 0; height: fit-content; width: 100%; display: inline-flex; margin-bottom: 0.2rem;  padding-left: 0.5rem;">
                Heading Velocity: <h2 id="HeadingVelo"
                    style=" margin: 0; font-size: 100%; font-weight: 500; padding-left: 0.5rem;  padding-top: 2px;">
                </h2>
            </div>
        </div>

        <div
            style="width: 100%; height: 40px; border-style: solid; margin-top: 20px; padding-top: 4px; padding-left: 4px; font-size: 100%; font-weight: 500; display: inline-flex;">
            loop time: <h2 id="loopTimeDis"
                style="font-size: 100%; font-weight: 500; padding: 0; margin: 0; height: fit-content; padding-left: 5px; padding-top: 2px;">
            </h2>
        </div>

    </div>

    <button onclick="displayParsedData()" id="display">Clear Data</button>
    <button onclick="createPoints()" id="displayPath">Build Path Data</button>


    <!-- <div
        style="position: absolute; left: 200px; top: 100px; width: 5px; height: 5px; background-color: rgb(255, 255, 255);">
    </div> -->

    <script>

        var slider = document.getElementById("mySlider");
        var output = document.getElementById("sliderValue");
        var end = document.getElementById("end");
        var start = document.getElementById("start");

        output.innerHTML = slider.value; // Display the default slider value

        slider.oninput = function () {
            output.innerHTML = this.value;
            updateDisplay();
            createPoints();
        }

        var loopTime = [];

        var xValues = [];
        var yValues = [];
        var headingValues = [];

        var xVelo = [];
        var yVelo = [];
        var headingVelo = [];

        var leftPod = [];
        var rightPod = [];
        var centerPod = [];

        function updateDisplay() {
            var LoopTime = document.getElementById("loopTimeDis");

            var XPosition = document.getElementById("XPosition");
            var YPosition = document.getElementById("YPosition");
            var Heading = document.getElementById("Heading");

            var LeftPod = document.getElementById("LeftPod");
            var RightPod = document.getElementById("RightPod");
            var CenterPod = document.getElementById("CenterPod");

            var XVelo = document.getElementById("XVelo");
            var YVelo = document.getElementById("YVelo");
            var HeadingVelo = document.getElementById("HeadingVelo");

            LoopTime.innerHTML = loopTime[slider.value]

            XPosition.innerHTML = xValues[slider.value]
            YPosition.innerHTML = yValues[slider.value]
            Heading.innerHTML = headingValues[slider.value]

            LeftPod.innerHTML = leftPod[slider.value]
            RightPod.innerHTML = rightPod[slider.value]
            CenterPod.innerHTML = centerPod[slider.value]

            XVelo.innerHTML = xVelo[slider.value]
            YVelo.innerHTML = yVelo[slider.value]
            HeadingVelo.innerHTML = headingVelo[slider.value]

        }

        function dragOverHandler(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'copy';
        }

        function dropHandler(event) {
            event.preventDefault();
            var files = event.dataTransfer.files;
            if (files.length > 0) {
                var file = files[0];
                var reader = new FileReader();
                reader.onload = function (e) {
                    var content = e.target.result;
                    parseFileContent(content);
                    slider.max = loopTime.length - 1;
                    end.innerHTML = loopTime.length - 1;
                    alert("File content has been parsed and stored.");
                };
                reader.readAsText(file);
            }
        }

        function parseFileContent(content) {
            // Split the content by lines
            var lines = content.split('\n');
            for (var i = 0; i < lines.length; i++) {

                var line = lines[i].trim();
                var parts = line.split(':');

                if (parts.length === 2) {

                    if (parts[0].trim().startsWith('loop time')) {
                        loopTime.push(parseFloat(parts[1]));
                    }

                    if (parts[0].trim().startsWith('X Position')) {
                        xValues.push(parseFloat(parts[1]));
                    } else if (parts[0].trim().startsWith('Y Position')) {
                        yValues.push(parseFloat(parts[1]));
                    } else if (parts[0].trim().startsWith('Heading Position')) {
                        headingValues.push(parseFloat(parts[1]));
                    }

                    if (parts[0].trim().startsWith('X Velocity')) {
                        xVelo.push(parseFloat(parts[1]));
                    } else if (parts[0].trim().startsWith('Y Velocity')) {
                        yVelo.push(parseFloat(parts[1]));
                    } else if (parts[0].trim().startsWith('Heading Velocity')) {
                        headingVelo.push(parseFloat(parts[1]));
                    }

                    if (parts[0].trim().startsWith('Left Pod')) {
                        leftPod.push(parseFloat(parts[1]));
                    } else if (parts[0].trim().startsWith('Right Pod')) {
                        rightPod.push(parseFloat(parts[1]));
                    } else if (parts[0].trim().startsWith('Center Pod')) {
                        centerPod.push(parseFloat(parts[1]));
                    }

                }
            }
        }

        // Example function to access parsed data
        function displayParsedData() {
            console.log("Numbers: ", loopTime);
            console.log("X Values: ", xValues);
            console.log("Y Values: ", yValues);
            console.log("left: ", leftPod);
            console.log("right: ", rightPod);
            console.log("center: ", centerPod);
        }

        var createdPoints = [];

        var RobotPos = [];

        function createPoints() {
            deletePoints();
            var dropZone = document.getElementById("drop_zone");

            for (var i = 0; i < slider.value; i++) {
                var point = document.createElement("div");
                point.className = "point";
                point.style.top = -((xValues[i] * 1.5)) + 586 + "px";
                point.style.left = (yValues[i] * 1.5) + 51 + "px";
                dropZone.appendChild(point);

                createdPoints.push(point);
            }

            var robotPosition = document.createElement("div");

            robotPosition.className = "robotPos";
            robotPosition.style.top = -((xValues[slider.value] * 1.5)) + 586 + "px";
            robotPosition.style.left = (yValues[slider.value] * 1.5) + 50 + "px";

            dropZone.appendChild(robotPosition);

            RobotPos.push(robotPosition);

        }

        function deletePoints() {
            var dropZone = document.getElementById("drop_zone");
            RobotPos.forEach(function (robotPosition) {
                dropZone.removeChild(robotPosition);
            });
            createdPoints.forEach(function (point) {
                dropZone.removeChild(point);
            });
            createdPoints = [];
        }
    </script>

</body>

</html>